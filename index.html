<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<meta name="screen-orientation" content="landscape">
<meta name="orientation" content="landscape">
<title>Mobile R6 Shooter</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;touch-action:none}
html,body{width:100%;height:100%;overflow:hidden;background:#000}
canvas{display:block}

/* Ï°∞Ïù¥Ïä§Ìã± */
#joyBase{position:fixed;left:5vw;bottom:12vh;width:140px;height:140px;border-radius:50%;background:rgba(255,255,255,.15);z-index:10}
#joyStick{position:absolute;left:50px;top:50px;width:40px;height:40px;border-radius:50%;background:#fff}

/* Î≤ÑÌäº */
.btn{position:fixed;right:4vw;padding:14px;border-radius:14px;border:none;font-size:18px;z-index:10}
#shoot{bottom:12vh} #aim{bottom:22vh} #reload{bottom:32vh}

/* HUD */
#hud{position:fixed;top:10px;left:10px;color:white;z-index:10}
#hud div{background:rgba(0,0,0,.5);padding:6px 10px;border-radius:8px;margin-bottom:6px}

/* Ï°∞Ï§ÄÏ†ê */
#crosshair{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);font-size:30px;color:red;display:none;z-index:20}

/* ÌïòÎã® Î¨¥Í∏∞ ÏÑ†ÌÉù */
#weaponBar{position:fixed;left:50%;bottom:2vh;transform:translateX(-50%);display:flex;gap:8px;z-index:15}
.weaponSlot{background:rgba(0,0,0,.6);color:white;padding:8px 12px;border-radius:10px;font-size:14px}

/* ÎãâÎÑ§ÏûÑ */
#nickBox{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;justify-content:center;align-items:center;color:white;z-index:100}
#nickBox input{font-size:20px;padding:10px}
#nickBox button{margin-top:10px;font-size:18px}
</style>
</head>

<body>

<div id="nickBox">
  <h2>ÎãâÎÑ§ÏûÑ</h2>
  <input id="nickInput" placeholder="ÎãâÎÑ§ÏûÑ (developer Í∞ÄÎä•)">
  <button onclick="startGame()">ÏãúÏûë</button>
</div>

<div id="joyBase"><div id="joyStick"></div></div>
<button id="shoot" class="btn">üî´</button>
<button id="aim" class="btn">üéØ</button>
<button id="reload" class="btn">üîÅ</button>

<div id="hud">
  <div id="ammo">üî´</div>
  <div id="money">$0</div>
  <div id="hp">‚ù§Ô∏è 100</div>
</div>

<div id="crosshair">‚úñ</div>
<div id="weaponBar"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155/build/three.min.js"></script>
<script>
/* ===== ÏÉÅÌÉú ===== */
let nickname="", money=0, hp=100;
let ownedWeapons=new Set();
let currentWeapon,wepAmmo,weaponMesh;
let aiming=false,kick=0;

/* ===== Î¨¥Í∏∞ Îç∞Ïù¥ÌÑ∞ (ÎîîÌÖåÏùº Î∞òÏòÅ) ===== */
const weapons={
  revolver:{price:0,ammo:6,recoil:.35,damage:35},
  m1911:{price:10000,ammo:7,recoil:.2,damage:30},
  shotgun:{price:15000,ammo:2,recoil:.7,damage:60},
  m16:{price:20000,ammo:30,recoil:.18,damage:20}
};

/* ===== ÏãúÏûë ===== */
function startGame(){
  nickname=document.getElementById("nickInput").value.trim();
  if(!nickname) return;

  ownedWeapons.clear(); money=0; hp=100;

  if(nickname==="developer"){
    Object.keys(weapons).forEach(w=>ownedWeapons.add(w));
    money=999999;
  }else ownedWeapons.add("revolver");

  equipWeapon("revolver");
  renderWeaponBar();
  updateHUD();
  nickBox.style.display="none";
}

/* ===== THREE Í∏∞Î≥∏ ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0xcfa46a);

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,500);
camera.rotation.order="YXZ";

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.7));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(20,40,20); scene.add(sun);

/* Î∞îÎã• */
const ground=new THREE.Mesh(
  new THREE.PlaneGeometry(500,500),
  new THREE.MeshStandardMaterial({color:0xc2a46d})
);
ground.rotation.x=-Math.PI/2; scene.add(ground);

/* ===== Ï∫êÎ¶≠ÌÑ∞ (R6 ÎπÑÏú®) ===== */
const player=new THREE.Group(); scene.add(player);
function box(w,h,d,c){return new THREE.Mesh(new THREE.BoxGeometry(w,h,d),new THREE.MeshStandardMaterial({color:c}))}
const torso=box(2.2,2.2,1.2,0x2f6bdc); torso.position.y=3; player.add(torso);
const head=box(1.8,1.8,1.8,0xffd92e); head.position.y=4.8; player.add(head);
const rArm=box(.9,2.2,.9,0xffd92e); rArm.position.set(1.8,3,0); player.add(rArm);
const lArm=box(.9,2.2,.9,0xffd92e); lArm.position.set(-1.8,3,0); player.add(lArm);
const lLeg=box(1,2.4,1,0x2ecc71); lLeg.position.set(-.6,1.2,0); player.add(lLeg);
const rLeg=box(1,2.4,1,0x2ecc71); rLeg.position.set(.6,1.2,0); player.add(rLeg);

/* ===== Î¨¥Í∏∞ Ïû•Ï∞© (Î∞©Ìñ•/Î∞òÎèô FIX) ===== */
function equipWeapon(id){
  if(!ownedWeapons.has(id)){
    if(money<weapons[id].price) return;
    money-=weapons[id].price;
    ownedWeapons.add(id);
  }
  if(weaponMesh) rArm.remove(weaponMesh);

  currentWeapon=weapons[id];
  wepAmmo=currentWeapon.ammo;

  weaponMesh=new THREE.Mesh(
    new THREE.BoxGeometry(1.6,.3,.3),
    new THREE.MeshStandardMaterial({color:0x222})
  );
  weaponMesh.position.set(0,-1,1);
  weaponMesh.rotation.y=Math.PI; // ÏôºÏ™Ω Ìñ•ÌïòÎçò Î≤ÑÍ∑∏ FIX
  rArm.add(weaponMesh);

  updateHUD();
}

/* ===== HUD ===== */
const ammoEl=document.getElementById("ammo");
const moneyEl=document.getElementById("money");
const hpEl=document.getElementById("hp");
function updateHUD(){
  ammoEl.innerText="üî´ "+wepAmmo;
  moneyEl.innerText="$"+money;
  hpEl.innerText="‚ù§Ô∏è "+hp;
}

/* ===== ÌïòÎã® Î¨¥Í∏∞Î∞î ===== */
function renderWeaponBar(){
  weaponBar.innerHTML="";
  ownedWeapons.forEach(id=>{
    const s=document.createElement("div");
    s.className="weaponSlot";
    s.innerText=id;
    s.onclick=()=>equipWeapon(id);
    weaponBar.appendChild(s);
  });
}

/* ===== ÏÇ¨Í≤© (Î∞òÎèô/Ï≤¥Í∞ê Í∞ïÌôî) ===== */
shoot.onclick=()=>{
  if(wepAmmo<=0) return;
  wepAmmo--;
  kick = aiming ? currentWeapon.recoil*0.4 : currentWeapon.recoil;
  updateHUD();
};

/* ===== Ïû¨Ïû•Ï†Ñ ===== */
reload.onclick=()=>{ wepAmmo=currentWeapon.ammo; updateHUD(); };

/* ===== Ï°∞Ï§Ä ===== */
aim.onclick=()=>{
  aiming=!aiming;
  crosshair.style.display=aiming?"block":"none";
  camera.fov=aiming?45:70;
  camera.updateProjectionMatrix();
};

/* ===== ÌîºÍ≤©/Ï≤¥Î†• ===== */
function takeDamage(dmg){
  hp-=dmg;
  document.body.style.background="#400";
  setTimeout(()=>document.body.style.background="#000",120);
  if(hp<=0){
    hp=100;
    player.position.set(0,0,0);
  }
  updateHUD();
}

/* ===== Ï°∞Ïù¥Ïä§Ìã± + ÏãúÏ†ê ===== */
let mx=0,mz=0,mt=null,lt=null,jc={},ll={};

addEventListener("touchstart",e=>{
  for(const t of e.touches){
    if(t.clientX<innerWidth/2 && mt===null){mt=t.identifier;jc={x:t.clientX,y:t.clientY}}
    else if(t.clientX>=innerWidth/2 && lt===null){lt=t.identifier;ll={x:t.clientX,y:t.clientY}}
  }
});
addEventListener("touchmove",e=>{
  for(const t of e.touches){
    if(t.identifier===mt){
      const dx=t.clientX-jc.x,dy=t.clientY-jc.y;
      mx=Math.max(-1,Math.min(1,dx/50));
      mz=Math.max(-1,Math.min(1,dy/50));
      joyStick.style.transform=`translate(${dx}px,${dy}px)`;
    }
    if(t.identifier===lt){
      camera.rotation.y-=(t.clientX-ll.x)*0.005;
      camera.rotation.x-=(t.clientY-ll.y)*0.005;
      camera.rotation.x=Math.max(-1.2,Math.min(1.2,camera.rotation.x));
      ll={x:t.clientX,y:t.clientY};
    }
  }
});
addEventListener("touchend",e=>{
  for(const t of e.changedTouches){
    if(t.identifier===mt){mt=null;mx=mz=0;joyStick.style.transform="translate(0,0)"}
    if(t.identifier===lt) lt=null;
  }
});

/* ===== Î£®ÌîÑ ===== */
function animate(){
  requestAnimationFrame(animate);

  kick*=0.6;
  rArm.rotation.x=-kick;

  const forward=new THREE.Vector3();
  camera.getWorldDirection(forward);
  forward.y=0; forward.normalize();
  const right=new THREE.Vector3().crossVectors(forward,new THREE.Vector3(0,1,0));

  player.position.addScaledVector(forward,-mz*0.4);
  player.position.addScaledVector(right,mx*0.4);

  const camOffset=forward.clone().multiplyScalar(-8);
  camOffset.y=4;
  camera.position.copy(player.position).add(camOffset);
  camera.lookAt(player.position.x,player.position.y+3,player.position.z);

  renderer.render(scene,camera);
}
animate();

/* ===== Î¶¨ÏÇ¨Ïù¥Ï¶à ===== */
function resize(){
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
}
addEventListener("resize",resize);
addEventListener("orientationchange",resize);
</script>
</body>
</html>