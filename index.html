<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Cowboy AI Battle</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:black;touch-action:none}
#ui{position:fixed;inset:0;pointer-events:none;color:white;font-family:sans-serif}
#cross{position:absolute;left:50%;top:50%;width:20px;height:20px;margin:-10px}
#cross:before,#cross:after{content:"";position:absolute;background:white}
#cross:before{width:20px;height:2px;top:9px}
#cross:after{width:2px;height:20px;left:9px}
#hp{position:absolute;top:10px;left:10px;width:120px;height:14px;border:2px solid white}
#hpIn{height:100%;background:red}
#bar{position:absolute;bottom:0;left:0;right:0;height:60px;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:space-between;padding:0 10px;pointer-events:auto}
#shop{position:fixed;inset:0;background:rgba(0,0,0,.95);display:none;pointer-events:auto;padding:20px}
.item{border-bottom:1px solid #444;padding:10px}
button{background:#222;color:white;border:none;padding:6px}
#flash{position:fixed;inset:0;background:red;opacity:0;pointer-events:none}
</style>
</head>

<body>
<canvas id="c"></canvas>
<div id="flash"></div>

<div id="ui">
  <div id="cross"></div>
  <div id="hp"><div id="hpIn"></div></div>
  <div id="bar">
    <div id="money">$0</div>
    <button onclick="openShop()">SHOP</button>
  </div>
</div>

<div id="shop">
  <button onclick="closeShop()">닫기</button>
  <h2>무기 상점</h2>
  <div id="items"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* ===== THREE ===== */
const renderer=new THREE.WebGLRenderer({canvas:document.getElementById("c")});
renderer.setSize(innerWidth,innerHeight);
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);
const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,.1,1000);
scene.add(new THREE.AmbientLight(0xffffff,.6));
const dl=new THREE.DirectionalLight(0xffffff,1);dl.position.set(5,10,5);scene.add(dl);
const ground=new THREE.Mesh(new THREE.PlaneGeometry(200,200),new THREE.MeshStandardMaterial({color:0x228B22}));
ground.rotation.x=-Math.PI/2;scene.add(ground);

/* ===== 플레이어 ===== */
const player=new THREE.Mesh(
  new THREE.BoxGeometry(2,4,1),
  new THREE.MeshStandardMaterial({color:0x0066ff})
);
player.position.y=2;
scene.add(player);

/* ===== AI 적 ===== */
const enemy=new THREE.Mesh(
  new THREE.BoxGeometry(2,4,1),
  new THREE.MeshStandardMaterial({color:0xff0000})
);
enemy.position.set(0,2,-20);
scene.add(enemy);
let enemyHP=100;

/* ===== 체력 ===== */
let hp=100;
const hpIn=document.getElementById("hpIn");
function damage(v){
  hp=Math.max(0,hp-v);
  hpIn.style.width=hp+"%";
  document.getElementById("flash").style.opacity=.4;
  setTimeout(()=>flash.style.opacity=0,120);
  if(hp<=0)respawn();
}
function respawn(){
  hp=100;
  hpIn.style.width="100%";
  player.position.set(0,2,0);
}

/* ===== 돈 ===== */
let money=0;
function addMoney(v){
  money+=v;
  const m=document.getElementById("money");
  m.innerText="+"+v+"$";
  setTimeout(()=>m.innerText="$"+money,800);
}

/* ===== 무기 ===== */
const weapons={
  revolver:{price:500,damage:25},
  glock:{price:2000,damage:15},
  shotgun:{price:8000,damage:60}
};
let owned={revolver:true};
let current="revolver";

/* ===== 상점 ===== */
function openShop(){
  shop.style.display="block";
  items.innerHTML="";
  for(let k in weapons){
    const w=weapons[k];
    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      ${k} - ${w.price}$ 
      ${owned[k]?"(보유)":"<button>구매</button>"}
    `;
    if(!owned[k]){
      div.querySelector("button").onclick=()=>{
        if(money>=w.price){
          money-=w.price;
          owned[k]=true;
          current=k;
          document.getElementById("money").innerText="$"+money;
          openShop();
        }
      };
    }
    items.appendChild(div);
  }
}
function closeShop(){shop.style.display="none"}

/* ===== 사격 ===== */
const ray=new THREE.Raycaster();
addEventListener("pointerdown",e=>{
  ray.setFromCamera({x:0,y:0},camera);
  const hit=ray.intersectObject(enemy);
  if(hit.length){
    enemyHP-=weapons[current].damage;
    if(enemyHP<=0){
      addMoney(Math.floor(Math.random()*10)+1);
      enemyHP=100;
      enemy.position.set(Math.random()*20-10,2,-20);
    }
  }
});

/* ===== AI 로직 ===== */
setInterval(()=>{
  enemy.lookAt(player.position);
  if(enemy.position.distanceTo(player.position)<15){
    damage(5);
  }
},1000);

/* ===== 루프 ===== */
function loop(){
  requestAnimationFrame(loop);
  camera.position.lerp(player.position.clone().add(new THREE.Vector3(0,6,10)),.1);
  camera.lookAt(player.position);
  renderer.render(scene,camera);
}
loop();
</script>
</body>
</html>
<script src="guns.js"></script>