<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Mobile FPS WORKING</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  touch-action: none;
  background: #000;
}
canvas { display: block; }

/* 조준점 */
#cross {
  position: fixed;
  left: 50%;
  top: 50%;
  width: 16px;
  height: 16px;
  margin-left: -8px;
  margin-top: -8px;
  pointer-events: none;
}
#cross::before, #cross::after {
  content: "";
  position: absolute;
  background: white;
}
#cross::before { width: 16px; height: 2px; top: 7px; }
#cross::after { width: 2px; height: 16px; left: 7px; }

/* 조이스틱 */
#joystick {
  position: fixed;
  left: 20px;
  bottom: 20px;
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: rgba(255,255,255,0.15);
  touch-action: none;
}
#stick {
  position: absolute;
  left: 40px;
  top: 40px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255,255,255,0.6);
}
</style>
</head>

<body>
<canvas id="c"></canvas>
<div id="cross"></div>
<div id="joystick"><div id="stick"></div></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
/* =====================
   THREE BASIC
===================== */
const renderer = new THREE.WebGLRenderer({ canvas: c, antialias: true });
renderer.setSize(innerWidth, innerHeight);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(
  75, innerWidth / innerHeight, 0.1, 1000
);

scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const light = new THREE.DirectionalLight(0xffffff, 0.6);
light.position.set(5,10,5);
scene.add(light);

/* =====================
   MAP
===================== */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(1000,1000),
  new THREE.MeshStandardMaterial({ color: 0x4caf50 })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

/* =====================
   PLAYER
===================== */
const player = new THREE.Object3D();
player.position.set(0, 0, 5);
scene.add(player);

/* =====================
   CONTROL STATE
===================== */
let moveX = 0, moveY = 0;
let yaw = 0, pitch = 0;

/* =====================
   JOYSTICK (LEFT)
===================== */
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");

joystick.addEventListener("touchstart", e => e.preventDefault(), { passive:false });

joystick.addEventListener("touchmove", e => {
  e.preventDefault();
  const t = e.touches[0];
  const r = joystick.getBoundingClientRect();

  const dx = t.clientX - (r.left + r.width/2);
  const dy = t.clientY - (r.top + r.height/2);

  moveX = Math.max(-1, Math.min(1, dx / 40));
  moveY = Math.max(-1, Math.min(1, dy / 40));

  stick.style.transform =
    `translate(${moveX*30}px, ${moveY*30}px)`;
}, { passive:false });

joystick.addEventListener("touchend", e => {
  e.preventDefault();
  moveX = moveY = 0;
  stick.style.transform = "translate(0,0)";
}, { passive:false });

/* =====================
   LOOK (RIGHT)
===================== */
let lastX = 0, lastY = 0;

document.addEventListener("touchstart", e => {
  if (e.touches[0].clientX < innerWidth/2) return;
  lastX = e.touches[0].clientX;
  lastY = e.touches[0].clientY;
}, { passive:false });

document.addEventListener("touchmove", e => {
  if (e.touches[0].clientX < innerWidth/2) return;
  e.preventDefault();

  const dx = e.touches[0].clientX - lastX;
  const dy = e.touches[0].clientY - lastY;
  lastX = e.touches[0].clientX;
  lastY = e.touches[0].clientY;

  yaw -= dx * 0.005;
  pitch -= dy * 0.005;
  pitch = Math.max(-1.2, Math.min(1.2, pitch));
}, { passive:false });

/* =====================
   LOOP
===================== */
function loop() {
  requestAnimationFrame(loop);

  const speed = 0.15;
  player.position.x +=
    (Math.sin(yaw)*moveY + Math.cos(yaw)*moveX) * speed;
  player.position.z +=
    (Math.cos(yaw)*moveY - Math.sin(yaw)*moveX) * speed;

  camera.position.set(
    player.position.x,
    player.position.y + 1.6,
    player.position.z
  );
  camera.rotation.set(pitch, yaw, 0);

  renderer.render(scene, camera);
}
loop();
</script>
</body>
</html>