<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>FPS TEST</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    touch-action: none;
    background: #222;
  }

  canvas {
    display: block;
  }

  /* Joystick */
  #joy {
    position: fixed;
    left: 20px;
    bottom: 20px;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: rgba(255,255,255,0.1);
  }
  #stick {
    position: absolute;
    left: 40px;
    top: 40px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255,255,255,0.8);
  }

  /* Crosshair */
  #cross {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);
    color: red;
    font-size: 24px;
    pointer-events: none;
  }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="joy">
  <div id="stick"></div>
</div>

<div id="cross">+</div>

<script>
/* ===== Canvas ===== */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

/* ===== Player ===== */
let px = 0, pz = 0;
let angle = 0;
let speedX = 0, speedZ = 0;

/* ===== Joystick ===== */
const joy = document.getElementById("joy");
const stick = document.getElementById("stick");
let joyActive = false;
let joyCenter = {x:0,y:0};

joy.addEventListener("touchstart", e => {
  joyActive = true;
  const r = joy.getBoundingClientRect();
  joyCenter.x = r.left + r.width/2;
  joyCenter.y = r.top + r.height/2;
});

joy.addEventListener("touchmove", e => {
  if (!joyActive) return;
  const t = e.touches[0];
  let dx = t.clientX - joyCenter.x;
  let dy = t.clientY - joyCenter.y;
  const max = 40;
  const dist = Math.hypot(dx,dy);
  if (dist > max) {
    dx = dx/dist * max;
    dy = dy/dist * max;
  }
  stick.style.left = 40 + dx + "px";
  stick.style.top  = 40 + dy + "px";
  speedX = dx / max;
  speedZ = dy / max;
});

joy.addEventListener("touchend", e => {
  joyActive = false;
  speedX = speedZ = 0;
  stick.style.left = "40px";
  stick.style.top  = "40px";
});

/* ===== Camera Drag (Right side only) ===== */
let look = false;
let lastX = 0;
addEventListener("touchstart", e => {
  const t = e.touches[0];
  if (t.clientX > innerWidth/2) {
    look = true;
    lastX = t.clientX;
  }
});
addEventListener("touchmove", e => {
  if (!look) return;
  const t = e.touches[0];
  const dx = t.clientX - lastX;
  angle += dx * 0.005;
  lastX = t.clientX;
});
addEventListener("touchend", ()=> look=false);

/* ===== Loop ===== */
function loop() {
  px += Math.cos(angle) * speedZ * 5;
  pz += Math.sin(angle) * speedZ * 5;
  px += Math.cos(angle + Math.PI/2) * speedX * 5;
  pz += Math.sin(angle + Math.PI/2) * speedX * 5;

  ctx.fillStyle = "#222";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Grid floor
  ctx.strokeStyle = "#333";
  for (let i=-50;i<50;i++) {
    ctx.beginPath();
    ctx.moveTo(canvas.width/2 - px + i*50, 0);
    ctx.lineTo(canvas.width/2 - px + i*50, canvas.height);
    ctx.stroke();

    ctx.beginPath();
    ctx.moveTo(0, canvas.height/2 - pz + i*50);
    ctx.lineTo(canvas.width, canvas.height/2 - pz + i*50);
    ctx.stroke();
  }

  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>