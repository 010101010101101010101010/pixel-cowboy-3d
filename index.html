<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Mobile R6 Shooter</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;touch-action:none}
html,body{width:100%;height:100%;overflow:hidden;background:#000}
canvas{display:block}

/* UI */
#joyBase{
  position:fixed;left:20px;bottom:20px;
  width:120px;height:120px;border-radius:50%;
  background:rgba(255,255,255,.15);z-index:10;
}
#joyStick{
  position:absolute;left:40px;top:40px;
  width:40px;height:40px;border-radius:50%;
  background:#fff;
}
.btn{
  position:fixed;right:20px;
  padding:14px;border-radius:14px;
  border:none;font-size:18px;z-index:10;
}
#shoot{bottom:20px}
#aim{bottom:90px}
#reload{bottom:160px}
#shopBtn{top:20px}

#hud{
  position:fixed;top:10px;left:10px;
  color:white;z-index:10;
}
#hud div{
  background:rgba(0,0,0,.5);
  padding:6px 10px;border-radius:8px;
  margin-bottom:6px;
}

#crosshair{
  position:fixed;left:50%;top:50%;
  transform:translate(-50%,-50%);
  font-size:30px;color:red;
  display:none;z-index:20;
}

/* ë‹‰ë„¤ì„ */
#nickBox{
  position:fixed;inset:0;background:#000;
  display:flex;flex-direction:column;
  justify-content:center;align-items:center;
  color:white;z-index:100;
}
#nickBox input{font-size:20px;padding:10px}
#nickBox button{margin-top:10px;font-size:18px}

/* ìƒì  */
#shop{
  position:fixed;inset:0;background:rgba(0,0,0,.9);
  color:white;display:none;z-index:200;padding:10px;
}
#shop button{margin:5px;padding:8px}
</style>
</head>

<body>

<!-- ë‹‰ë„¤ì„ -->
<div id="nickBox">
  <h2>ë‹‰ë„¤ì„</h2>
  <input id="nickInput" placeholder="ë‹‰ë„¤ì„">
  <button onclick="startGame()">ì‹œì‘</button>
</div>

<!-- UI -->
<div id="joyBase"><div id="joyStick"></div></div>
<button id="shoot" class="btn">ğŸ”«</button>
<button id="aim" class="btn">ğŸ¯</button>
<button id="reload" class="btn">ğŸ”</button>
<button id="shopBtn" class="btn">ğŸ›’</button>

<div id="hud">
  <div id="ammo">ğŸ”«</div>
  <div id="money">$0</div>
</div>

<div id="crosshair">âœ–</div>

<div id="shop">
  <button onclick="shopTab='weapons';renderShop()">ğŸ”« ë¬´ê¸°</button>
  <button onclick="shopTab='clothes';renderShop()">ğŸ‘• ì˜·</button>
  <button onclick="shop.style.display='none'">ë‹«ê¸°</button>
  <div id="shopList"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155/build/three.min.js"></script>
<script>
/* ===== DOM ===== */
const ammoEl = document.getElementById("ammo");
const moneyEl = document.getElementById("money");

/* ===== ìƒíƒœ ===== */
let nickname="", money=0;
let ownedWeapons = new Set();
let shopTab="weapons";

/* ===== ë¬´ê¸° ë°ì´í„° ===== */
const weapons={
  revolver:{price:0,ammo:6,recoil:.25,mode:"semi"},
  m1911:{price:10000,ammo:7,recoil:.1,mode:"semi"},
  shotgun:{price:15000,ammo:2,recoil:.4,mode:"semi"},
  m16:{price:20000,ammo:30,recoil:.15,mode:"burst"},
  airsoft:{price:100,ammo:50,recoil:.02,mode:"auto"},
  kar98k:{price:30000,ammo:5,recoil:.5,mode:"bolt"}
};
let currentWeapon,wepAmmo,weaponMesh,kick=0,boltReady=true;

/* ===== ì‹œì‘ ===== */
function startGame(){
  nickname = document.getElementById("nickInput").value.trim();
  if(!nickname) return;

  ownedWeapons.clear();
  money = 0;

  if(nickname === "developer"){
    for(const k in weapons) ownedWeapons.add(k);
    money = 999999;
    alert("ê°œë°œì ëª¨ë“œ í™œì„±í™”");
  }else{
    ownedWeapons.add("revolver");
  }

  equipWeapon("revolver");
  updateHUD();
  document.getElementById("nickBox").style.display="none";
}

/* ===== THREE ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0xcfa46a);
const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,.1,200);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,.7));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(20,40,20);scene.add(sun);

const ground=new THREE.Mesh(
  new THREE.PlaneGeometry(300,300),
  new THREE.MeshStandardMaterial({color:0xc2a46d})
);
ground.rotation.x=-Math.PI/2;scene.add(ground);

/* ===== ìºë¦­í„° R6 ===== */
const player=new THREE.Group();scene.add(player);
function box(w,h,d,c){
  return new THREE.Mesh(
    new THREE.BoxGeometry(w,h,d),
    new THREE.MeshStandardMaterial({color:c})
  );
}
const Y=0xffd92e,B=0x2f6bdc,G=0x2ecc71;
const torso=box(2.2,2.2,1.2,B);torso.position.y=3;player.add(torso);
const head=box(1.8,1.8,1.8,Y);head.position.y=4.8;player.add(head);
const rArm=box(.9,2.2,.9,Y);rArm.position.set(1.8,3,0);player.add(rArm);
const lArm=box(.9,2.2,.9,Y);lArm.position.set(-1.8,3,0);player.add(lArm);
const lLeg=box(1,2.4,1,G);lLeg.position.set(-.6,1.2,0);player.add(lLeg);
const rLeg=box(1,2.4,1,G);rLeg.position.set(.6,1.2,0);player.add(rLeg);

/* ===== ë¬´ê¸° ì¥ì°© ===== */
function equipWeapon(id){
  if(!ownedWeapons.has(id)){
    if(money < weapons[id].price) return alert("ëˆ ë¶€ì¡±");
    money -= weapons[id].price;
    ownedWeapons.add(id);
  }
  if(weaponMesh) rArm.remove(weaponMesh);
  currentWeapon = weapons[id];
  wepAmmo = currentWeapon.ammo;
  boltReady = true;

  weaponMesh = new THREE.Mesh(
    new THREE.BoxGeometry(1.5,.3,.3),
    new THREE.MeshStandardMaterial({color:0x222})
  );
  weaponMesh.position.set(0,-1,1);
  rArm.add(weaponMesh);
  updateHUD();
}

/* ===== HUD ===== */
function updateHUD(){
  ammoEl.innerText = "ğŸ”« " + wepAmmo;
  moneyEl.innerText = "$" + money;
}

/* ===== ì‚¬ê²©/ì¥ì „ ===== */
shoot.onclick=()=>{
  if(wepAmmo<=0) return;
  if(currentWeapon.mode==="bolt" && !boltReady) return;
  wepAmmo--;
  kick=currentWeapon.recoil;
  if(currentWeapon.mode==="bolt") boltReady=false;
  updateHUD();
};
reload.onclick=()=>{
  wepAmmo=currentWeapon.ammo;
  boltReady=true;
  updateHUD();
};

/* ===== ì¡°ì¤€ ===== */
let aiming=false;
aim.onclick=()=>{
  aiming=!aiming;
  crosshair.style.display=aiming?"block":"none";
  camera.fov=aiming?45:70;
  camera.updateProjectionMatrix();
};

/* ===== ì¡°ì´ìŠ¤í‹± & ì‹œì  ===== */
let mx=0,mz=0,mt=null,lt=null,jc={},ll={};
addEventListener("touchstart",e=>{
  for(const t of e.touches){
    if(t.clientX<innerWidth/2 && mt===null){mt=t.identifier;jc={x:t.clientX,y:t.clientY}}
    else if(t.clientX>=innerWidth/2 && lt===null){lt=t.identifier;ll={x:t.clientX,y:t.clientY}}
  }
});
addEventListener("touchmove",e=>{
  for(const t of e.touches){
    if(t.identifier===mt){
      const dx=t.clientX-jc.x,dy=t.clientY-jc.y;
      mx=Math.max(-.15,Math.min(.15,dx/200));
      mz=Math.max(-.15,Math.min(.15,dy/200));
      joyStick.style.transform=`translate(${dx}px,${dy}px)`;
    }
    if(t.identifier===lt){
      camera.rotation.y-=(t.clientX-ll.x)*.005;
      camera.rotation.x-=(t.clientY-ll.y)*.005;
      ll={x:t.clientX,y:t.clientY};
    }
  }
});
addEventListener("touchend",e=>{
  for(const t of e.changedTouches){
    if(t.identifier===mt){mt=null;mx=mz=0;joyStick.style.transform="translate(0,0)"}
    if(t.identifier===lt) lt=null;
  }
});

/* ===== ìƒì  ===== */
shopBtn.onclick=()=>shop.style.display="block";
function renderShop(){
  shopList.innerHTML="";
  if(shopTab==="weapons"){
    for(const k in weapons){
      const owned = ownedWeapons.has(k);
      const b=document.createElement("button");
      b.innerText = owned ? `${k} (ë³´ìœ ì¤‘)` : `${k} $${weapons[k].price}`;
      b.disabled = owned;
      b.onclick = ()=>equipWeapon(k);
      shopList.appendChild(b);
    }
  }
}

/* ===== ë£¨í”„ ===== */
function animate(){
  requestAnimationFrame(animate);
  kick*=0.6;
  rArm.rotation.x=-kick;
  player.position.x+=mx;
  player.position.z+=mz;
  camera.position.set(player.position.x,player.position.y+4,player.position.z+7);
  camera.lookAt(player.position.x,player.position.y+3,player.position.z);
  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>